<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Google GoGen 3.0 ‚Äì Official Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ------------------------------------------------------------
   1. THEME & VARIABLES
------------------------------------------------------------ */
:root {
  --bg-color: #f8f9fa;
  --card-bg: #ffffff;
  --text-main: #202124;
  --text-sub: #5f6368;
  --google-blue: #1a73e8;
  --google-red: #ea4335;
  --google-yellow: #fbbc04;
  --google-green: #34a853;
  --border: #dadce0;
  --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  --shadow-hover: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
  --modal-overlay: rgba(32,33,36,0.6);
  --radius: 16px;
}

.dark {
  --bg-color: #121212;
  --card-bg: #1e1e1e;
  --text-main: #e8eaed;
  --text-sub: #9aa0a6;
  --google-blue: #8ab4f8;
  --google-red: #f28b82;
  --google-yellow: #fdd663;
  --google-green: #81c995;
  --border: #3c4043;
  --shadow: 0 4px 12px rgba(0,0,0,0.5);
  --shadow-hover: 0 8px 16px rgba(0,0,0,0.6);
}

/* ------------------------------------------------------------
   2. CORE LAYOUT & TYPOGRAPHY
------------------------------------------------------------ */
body { margin: 0; font-family: 'Google Sans', sans-serif; background-color: var(--bg-color); color: var(--text-main); transition: background 0.3s, color 0.3s; padding-bottom: 80px; overflow-x: hidden; }
.container { max-width: 850px; margin: 40px auto; padding: 0 20px; position: relative; z-index: 10; }
.hidden { display: none !important; }

/* Cards & Glassmorphism */
.card {
  background: var(--card-bg);
  border-radius: var(--radius);
  padding: 32px;
  margin-bottom: 24px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  transition: transform 0.2s, box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}
.card:hover { transform: translateY(-2px); box-shadow: var(--shadow-hover); }

/* Branding */
.brand-header { text-align: center; margin-bottom: 40px; animation: fadeInDown 0.8s; }
.brand-header img { height: 48px; margin-bottom: 12px; }
.brand-header h1 { margin: 0; font-size: 26px; font-weight: 500; letter-spacing: -0.5px; }

/* Inputs */
.input-group { position: relative; margin-bottom: 15px; }
input, select, textarea {
  width: 100%; box-sizing: border-box; padding: 16px;
  border-radius: 8px; border: 1px solid var(--border);
  background: var(--bg-color); color: var(--text-main);
  font-family: inherit; font-size: 16px; outline: none;
  transition: 0.2s;
}
input:focus, select:focus { border-color: var(--google-blue); box-shadow: 0 0 0 2px rgba(26,115,232,0.2); background: var(--card-bg); }

/* Buttons & Ripple Effect */
button {
  background: var(--google-blue); color: #fff; border: none; padding: 14px 28px;
  border-radius: 30px; font-weight: 500; font-size: 15px; cursor: pointer;
  transition: all 0.2s; width: 100%; position: relative; overflow: hidden;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
button:hover { filter: brightness(1.1); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
button:active { transform: scale(0.98); }
button:disabled { background: var(--border); cursor: not-allowed; transform: none; box-shadow: none; }

button.secondary { background: transparent; border: 1px solid var(--border); color: var(--text-main); box-shadow: none; }
button.secondary:hover { background: rgba(128,128,128,0.1); }
button.danger { background: var(--google-red); }
button.edit { background: var(--google-yellow); color: #202124; }
button.success { background: var(--google-green); }
button.small { width: auto; padding: 8px 16px; font-size: 13px; }

/* Ripple Animation CSS */
.ripple { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.4); transform: scale(0); animation: ripple 0.6s linear; pointer-events: none; }
@keyframes ripple { to { transform: scale(4); opacity: 0; } }

/* ------------------------------------------------------------
   3. ANIMATED TIMELINE
------------------------------------------------------------ */
.timeline-item { display: flex; position: relative; padding-bottom: 35px; opacity: 0; transform: translateY(10px); }
/* Staggered Animation Logic handled in JS */

.timeline-marker {
  width: 32px; height: 32px; border-radius: 50%; background: var(--border);
  z-index: 2; display: flex; align-items: center; justify-content: center;
  margin-right: 20px; color: white; font-size: 14px; font-weight: bold; flex-shrink: 0;
  border: 4px solid var(--card-bg); transition: 0.3s;
}
.timeline-line {
  position: absolute; left: 18px; top: 32px; bottom: 0; width: 3px; background: var(--border); z-index: 1;
  transition: background 0.5s ease;
}
.timeline-item:last-child .timeline-line { display: none; }

/* Status Styling */
.completed .timeline-marker { background: var(--google-green); transform: scale(1.1); }
.completed .timeline-line { background: var(--google-green); }

.active .timeline-marker { background: var(--google-blue); box-shadow: 0 0 0 4px rgba(26,115,232,0.2); transform: scale(1.2); }

.failed .timeline-marker { background: var(--google-red); }
.failed .timeline-line { background: var(--google-red); opacity: 0.5; }

.failure-box {
  margin-top: 12px; background: rgba(234, 67, 53, 0.1); border-left: 4px solid var(--google-red);
  padding: 12px 16px; border-radius: 0 8px 8px 0; color: var(--google-red); font-size: 14px;
  animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* ------------------------------------------------------------
   4. UI COMPONENTS (Toasts, Modals, Badges)
------------------------------------------------------------ */
/* Toasts Notification */
#toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 400px; }
.toast {
  background: #323232; color: white; padding: 14px 20px; border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: space-between;
  font-size: 14px; animation: slideUpToast 0.3s ease-out; opacity: 0.95;
}
.toast.success { border-left: 4px solid var(--google-green); }
.toast.error { border-left: 4px solid var(--google-red); }
.toast.info { border-left: 4px solid var(--google-blue); }

/* Badge */
.badge { padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block; }
.badge.pending { background: #f1f3f4; color: #5f6368; }
.badge.active { background: rgba(26,115,232,0.15); color: var(--google-blue); }
.badge.winner { background: rgba(52,168,83,0.15); color: var(--google-green); }
.badge.rejected { background: var(--google-red); color: white; }

/* Modals */
.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: var(--modal-overlay); backdrop-filter: blur(8px);
  z-index: 999; display: none; align-items: center; justify-content: center;
  animation: fadeIn 0.2s;
}
.modal-box {
  background: var(--card-bg); width: 90%; max-width: 450px; padding: 35px;
  border-radius: 24px; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
  animation: scaleUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Confetti */
.confetti { position: fixed; top: -10px; width: 10px; height: 10px; z-index: 1500; pointer-events: none; }

/* Admin Stats Bar */
.stat-bar { height: 4px; background: #eee; border-radius: 2px; margin-top: 5px; overflow: hidden; }
.stat-fill { height: 100%; border-radius: 2px; transition: width 1s ease; }

/* Utility */
.switch { position: fixed; top: 20px; right: 20px; cursor: pointer; background: var(--card-bg); padding: 10px; border-radius: 50%; box-shadow: var(--shadow); z-index: 100; font-size: 20px; transition: 0.3s; }
.switch:hover { transform: rotate(15deg) scale(1.1); }
.link-muted { color: var(--text-sub); text-align: center; margin-top: 30px; cursor: pointer; font-size: 13px; text-decoration: underline; opacity: 0.6; }
.link-muted:hover { opacity: 1; }

/* Keyframes */
@keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUpToast { from { opacity: 0; transform: translateY(100%); } to { opacity: 1; transform: translateY(0); } }
@keyframes scaleUp { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
@keyframes slideInRight { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* Loading Spinner */
.spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 0.8s linear infinite; margin-right: 8px; vertical-align: middle; }

/* Print */
@media print {
  body { background: white; color: black; padding: 0; }
  .no-print, button, .switch, .link-muted, .toast-container { display: none !important; }
  .card { box-shadow: none; border: 1px solid #ccc; break-inside: avoid; }
  .container { max-width: 100%; margin: 0; }
}

/* Admin Table */
.table-container { overflow-x: auto; margin-top: 15px; border-radius: 8px; border: 1px solid var(--border); }
table { width: 100%; border-collapse: collapse; font-size: 14px; background: var(--card-bg); }
th { text-align: left; color: var(--text-sub); border-bottom: 2px solid var(--border); padding: 14px; background: var(--bg-color); font-weight: 600; }
td { border-bottom: 1px solid var(--border); padding: 14px; color: var(--text-main); vertical-align: middle; }
tr:last-child td { border-bottom: none; }
.admin-actions { display: flex; gap: 8px; }

</style>
</head>
<body>

<div class="switch no-print" onclick="toggleTheme()" title="Toggle Dark Mode">üåì</div>

<div id="toast-container"></div>

<div id="stage0Modal" class="modal-overlay">
  <div class="modal-box">
    <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>
    <h2 style="margin-top:0; color:var(--text-main);">Application Pending</h2>
    <p style="color:var(--text-sub); line-height:1.6;">
      Your documents are not yet verified. Please ensure you have submitted all files to your facilitator.
    </p>
    <div style="background:var(--bg-color); padding:15px; border-radius:12px; margin:20px 0; font-size:14px; color:var(--text-sub); border:1px solid var(--border);">
      üìß <a href="mailto:info@shauryasingh.me" style="color:var(--google-blue); font-weight:bold; text-decoration:none;">info@shauryasingh.me</a>
    </div>
    <button onclick="document.getElementById('stage0Modal').style.display='none'">Understood</button>
  </div>
</div>

<div id="copyrightModal" class="modal-overlay">
  <div class="modal-box">
    <div style="font-size: 48px; margin-bottom: 20px;">‚öñÔ∏è</div>
    <h2 style="margin-top:0; color:var(--text-main);">Action Required</h2>
    <p style="color:var(--text-sub); line-height:1.6; font-size:15px;">
      To view your results, you must grant <b>Google GoGen</b> rights to evaluate and display your submission.
    </p>
    <div style="background:var(--bg-color); padding:15px; border-radius:12px; margin:20px 0; text-align:left; display:flex; align-items:center; cursor:pointer;" onclick="document.getElementById('agreeCheck').click()">
      <input type="checkbox" id="agreeCheck" style="width:20px; height:20px; margin:0 15px 0 0; cursor:pointer;">
      <label for="agreeCheck" style="font-size:14px; cursor:pointer; font-weight:500;">I agree to the Terms & Conditions.</label>
    </div>
    <button onclick="signCopyright()">Confirm & View Results</button>
  </div>
</div>

<div id="loginModal" class="modal-overlay">
  <div class="modal-box">
    <h2 style="margin-bottom:20px;">Staff Access</h2>
    <input type="text" id="adminUser" placeholder="Username" style="margin-bottom:10px;">
    <input type="password" id="adminPass" placeholder="Password">
    <div style="height:20px;"></div>
    <button onclick="attemptLogin()">Login Dashboard</button>
    <button class="secondary" onclick="document.getElementById('loginModal').style.display='none'" style="margin-top:10px;">Cancel</button>
  </div>
</div>

<div class="container">
  
  <div class="brand-header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" alt="Google">
    <h1>GoGen 3.0 <span style="color:var(--text-sub); font-weight:400;">ArtOFest</span></h1>
  </div>

  <div id="userView">
    
    <div class="card no-print">
      <h2 style="margin-top:0; margin-bottom:20px;">Track Application</h2>
      <div style="display:grid; grid-template-columns: 2fr 1fr; gap:15px; margin-bottom:20px;">
        <input id="userId" placeholder="Candidate ID (e.g. AZ0082)" onkeyup="if(event.key==='Enter') checkStatus()">
        <select id="userCohort">
          <option value="">Select Cohort</option>
          <option>Cohort 1</option>
          <option>Cohort 2</option>
          <option>Cohort 3</option>
          <option>Cohort 4</option>
        </select>
      </div>
      <button onclick="checkStatus()" id="searchBtn">Search Record</button>
    </div>

    <div id="resultsArea" class="hidden">
      
      <div id="userAnnounceBanner" class="hidden" style="background:rgba(251,188,4,0.15); border:1px solid var(--google-yellow); padding:16px; border-radius:12px; margin-bottom:24px; display:flex; align-items:center; animation:slideUp 0.5s;">
        <span style="font-size:24px; margin-right:15px;">üì¢</span>
        <div>
          <strong style="color:var(--text-main); display:block; margin-bottom:2px;">Latest Update</strong>
          <span id="userAnnounceText" style="color:var(--text-sub); font-size:14px;"></span>
        </div>
      </div>

      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:24px; padding-bottom:15px; border-bottom:1px solid var(--border);">
          <div>
            <h2 id="resName" style="margin:0; font-size:22px;">User Name</h2>
            <div style="color:var(--text-sub); font-size:14px; margin-top:4px;">ID: <span id="resID"></span> ‚Ä¢ <span id="resCohort"></span></div>
          </div>
          <span id="resBadge" class="badge pending">STATUS</span>
        </div>

        <div id="timelineContainer"></div>

        <div id="certBox" class="hidden no-print" style="margin-top:30px; text-align:center; background:linear-gradient(to right, rgba(52,168,83,0.05), rgba(52,168,83,0.1)); padding:25px; border-radius:16px; border:1px dashed var(--google-green);">
          <div style="font-size:40px; margin-bottom:10px;">üéì</div>
          <h3 style="margin:0 0 5px 0; color:var(--google-green);">Congratulations!</h3>
          <p style="color:var(--text-sub); font-size:14px; margin-bottom:15px;">Your certificate of completion is ready.</p>
          <button onclick="downloadCert()" class="small success" style="width:auto; padding:10px 24px;">Download Certificate</button>
        </div>

        <button onclick="window.print()" class="secondary small no-print" style="margin-top:20px; margin-left:auto; display:block; width:auto;">üñ®Ô∏è Print Report</button>

      </div>
    </div>
    <div class="link-muted no-print" onclick="document.getElementById('loginModal').style.display='flex'">Administrator Login</div>
  </div>

  <div id="adminView" class="hidden">
    
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <h2 style="margin:0;">Dashboard</h2>
          <small style="color:var(--text-sub);">Welcome, Admin</small>
        </div>
        <button class="secondary small" onclick="logout()" style="width:auto;">Logout</button>
      </div>

      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(100px, 1fr)); gap:15px; margin-top:25px;">
        <div style="padding:15px; background:var(--bg-color); border-radius:12px; border:1px solid var(--border);">
          <div style="font-size:12px; color:var(--text-sub); font-weight:bold;">TOTAL</div>
          <div style="font-size:28px; font-weight:bold; color:var(--google-blue);" id="statTotal">0</div>
          <div class="stat-bar"><div class="stat-fill" style="width:100%; background:var(--google-blue);"></div></div>
        </div>
        <div style="padding:15px; background:var(--bg-color); border-radius:12px; border:1px solid var(--border);">
          <div style="font-size:12px; color:var(--text-sub); font-weight:bold;">DISQUALIFIED</div>
          <div style="font-size:28px; font-weight:bold; color:var(--google-red);" id="statDQ">0</div>
          <div class="stat-bar"><div class="stat-fill" id="barDQ" style="width:0%; background:var(--google-red);"></div></div>
        </div>
        <div style="padding:15px; background:var(--bg-color); border-radius:12px; border:1px solid var(--border);">
          <div style="font-size:12px; color:var(--text-sub); font-weight:bold;">WINNERS</div>
          <div style="font-size:28px; font-weight:bold; color:var(--google-green);" id="statWinners">0</div>
          <div class="stat-bar"><div class="stat-fill" id="barWin" style="width:0%; background:var(--google-green);"></div></div>
        </div>
      </div>
    </div>

    <div class="card" style="border-left:5px solid var(--google-yellow);">
      <h3 style="margin-top:0;">Global Announcement</h3>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <input id="admAnnounceInput" placeholder="Message for all users..." style="margin-bottom:0; flex:1;">
        <button onclick="postAnnouncement()" class="small edit" style="width:auto;">Post Update</button>
        <button onclick="clearAnnouncement()" class="secondary small" style="width:auto;">Clear</button>
      </div>
    </div>

    <div class="card" id="editFormCard">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 id="formTitle" style="margin:0;">Manage Candidate</h3>
        <button onclick="resetForm()" class="secondary small" style="width:auto;">New / Reset</button>
      </div>
      
      <div style="display:grid; grid-template-columns: 1fr 2fr; gap:15px; margin-bottom:15px;">
        <div class="input-group"><input id="admId" placeholder="ID (Unique)"></div>
        <div class="input-group"><input id="admName" placeholder="Full Name"></div>
      </div>
      
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px;">
        <select id="admCohort">
          <option>Cohort 1</option>
          <option>Cohort 2</option>
          <option>Cohort 3</option>
          <option>Cohort 4</option>
        </select>
        <select id="admStage">
          <option value="0">0. App Received</option>
          <option value="1">1. Submission Verification</option>
          <option value="2">2. Quality Assessment</option>
          <option value="3">3. Innovation Review</option>
          <option value="4">4. Technical Precision</option>
          <option value="5">5. Jury Round</option>
          <option value="6">6. Final Winner</option>
        </select>
      </div>
      
      <div style="background:var(--bg-color); padding:15px; border-radius:12px; border:1px solid var(--border); margin-bottom:15px;">
        <div style="display:flex; align-items:center; margin-bottom:10px;">
          <input type="checkbox" id="admIneligible" style="width:20px; height:20px; margin:0 10px 0 0;" onchange="toggleReasonInput()">
          <label for="admIneligible" style="font-weight:bold; color:var(--google-red); cursor:pointer;">Mark as Ineligible (Disqualify)</label>
        </div>
        <input id="admReason" placeholder="Reason (e.g. Plagiarism, Late Submission)" disabled>
      </div>

      <input id="admCert" placeholder="Certificate URL (Optional)" style="margin-bottom:15px;">
      
      <button onclick="saveCandidate()">Save Candidate Record</button>
    </div>

    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h3 style="margin:0;">Candidate Database</h3>
        <button onclick="exportCSV()" class="secondary small" style="width:auto;">‚¨á Export CSV</button>
      </div>
      
      <div class="table-container">
        <table>
          <thead><tr><th>ID</th><th>Name</th><th>Cohort</th><th>Stage</th><th>Updated</th><th>Action</th></tr></thead>
          <tbody id="admTableBody"></tbody>
        </table>
      </div>
    </div>

  </div>

</div>

<script>
/* ------------------------------------------------------------
   1. CONFIGURATION & DATA
------------------------------------------------------------ */
const STAGES = [
  { t: "Application Received", d: "Documents under initial review." },
  { t: "Submission Verification", d: "Validating file formats and links." },
  { t: "Quality Assessment", d: "Design aesthetics evaluation." },
  { t: "Innovation Review", d: "Creativity and originality check." },
  { t: "Technical Precision", d: "Vector quality and layer check." },
  { t: "Jury Round", d: "Senior panel scoring and ranking." },
  { t: "Final Winner", d: "Award processing and certification." }
];

let db = {
  "AZ0082": { name: "Srishti Singh", cohort: "Cohort 3", stage: 3, signed: true, cert: "", ineligible: true, reason: "Incorrect submission format.", lastUpdated: "10/24/2023" },
  "TEST01": { name: "John Doe", cohort: "Cohort 1", stage: 0, signed: false, cert: "", ineligible: false, reason: "", lastUpdated: "10/25/2023" },
  "WIN001": { name: "Rahul Verma", cohort: "Cohort 2", stage: 6, signed: true, cert: "https://example.com", ineligible: false, reason: "", lastUpdated: "10/25/2023" }
};

if(localStorage.getItem("gogenPro_v9")) {
  db = JSON.parse(localStorage.getItem("gogenPro_v9"));
}

/* ------------------------------------------------------------
   2. PUBLIC LOGIC
------------------------------------------------------------ */
let currentLookUpId = null;

// Add ripple effect to buttons
document.querySelectorAll('button').forEach(btn => {
  btn.addEventListener('click', function(e) {
    let x = e.clientX - e.target.getBoundingClientRect().left;
    let y = e.clientY - e.target.getBoundingClientRect().top;
    let ripple = document.createElement('span');
    ripple.style.left = x + 'px';
    ripple.style.top = y + 'px';
    ripple.classList.add('ripple');
    this.appendChild(ripple);
    setTimeout(() => ripple.remove(), 600);
  });
});

function checkStatus() {
  const btn = document.getElementById("searchBtn");
  const id = document.getElementById("userId").value.trim();
  const cohort = document.getElementById("userCohort").value;
  const resArea = document.getElementById("resultsArea");

  if(!id || !cohort) { showToast("Please enter ID and Select Cohort", "error"); return; }

  // Loading Simulation
  btn.innerHTML = '<span class="spinner"></span> Searching...';
  btn.disabled = true;

  setTimeout(() => {
    btn.innerHTML = 'Search Record';
    btn.disabled = false;
    processSearch(id, cohort);
  }, 800); // 800ms fake delay
}

function processSearch(id, cohort) {
  const resArea = document.getElementById("resultsArea");
  
  // Check Announcement
  const ann = localStorage.getItem("gogenAnnounce");
  if(ann) {
    document.getElementById("userAnnounceBanner").classList.remove("hidden");
    document.getElementById("userAnnounceText").innerText = ann;
  } else {
    document.getElementById("userAnnounceBanner").classList.add("hidden");
  }

  if(!db[id] || db[id].cohort !== cohort) {
    showToast("‚ùå Record not found or Cohort mismatch.", "error");
    resArea.classList.add("hidden");
    return;
  }

  currentLookUpId = id;
  const user = db[id];

  // Stage 0 -> Alert
  if(user.stage === 0 && !user.ineligible) {
    document.getElementById("stage0Modal").style.display = "flex";
    resArea.classList.add("hidden");
    return;
  }

  // Copyright Gate
  if(user.stage >= 1 && !user.ineligible && !user.signed) {
    document.getElementById("copyrightModal").style.display = "flex";
    resArea.classList.add("hidden");
    return;
  }

  renderTimeline(user, id);
}

function signCopyright() {
  if(!document.getElementById("agreeCheck").checked) {
    showToast("You must agree to the terms.", "error");
    return;
  }
  db[currentLookUpId].signed = true;
  saveDB();
  document.getElementById("copyrightModal").style.display = "none";
  renderTimeline(db[currentLookUpId], currentLookUpId);
  showToast("Terms Accepted.", "success");
}

function renderTimeline(user, id) {
  document.getElementById("resultsArea").classList.remove("hidden");
  document.getElementById("resName").innerText = user.name;
  document.getElementById("resID").innerText = id;
  document.getElementById("resCohort").innerText = user.cohort;

  const badge = document.getElementById("resBadge");
  badge.className = "badge";
  if (user.ineligible) { badge.innerText = "Disqualified"; badge.classList.add("rejected"); }
  else if(user.stage === 6) { badge.innerText = "Winner"; badge.classList.add("winner"); setTimeout(triggerConfetti, 500); }
  else { badge.innerText = "In Progress"; badge.classList.add("active"); }

  let html = "";
  
  for (let i = 0; i < STAGES.length; i++) {
    // Animation Delay Calculation
    let delay = i * 150; 
    
    // Disqualified Logic
    if (user.ineligible && i === user.stage) {
      html += `
        <div class="timeline-item failed" style="animation: slideUp 0.5s ease forwards; animation-delay: ${delay}ms">
          <div class="timeline-line"></div>
          <div class="timeline-marker">‚úï</div>
          <div style="width:100%;">
            <div style="font-weight:bold; color:var(--google-red);">${STAGES[i].t} (Failed)</div>
            <div class="failure-box">
              <b>Reason:</b> ${user.reason || "Not specified."}
            </div>
          </div>
        </div>`;
      break; 
    }

    // Normal Logic
    let statusClass = "";
    let icon = i + 1;

    if (i < user.stage) { statusClass = "completed"; icon = "‚úì"; }
    else if (i === user.stage) { statusClass = "active"; icon = "‚óè"; }
    
    html += `
      <div class="timeline-item ${statusClass}" style="animation: slideUp 0.5s ease forwards; animation-delay: ${delay}ms">
        <div class="timeline-line"></div>
        <div class="timeline-marker">${icon}</div>
        <div>
          <div style="font-weight:500;">${STAGES[i].t}</div>
          <div style="font-size:13px; color:var(--text-sub);">${STAGES[i].d}</div>
        </div>
      </div>
    `;
  }

  document.getElementById("timelineContainer").innerHTML = html;

  if(user.cert && !user.ineligible && user.stage === 6) {
    document.getElementById("certBox").classList.remove("hidden");
    window.certLink = user.cert;
  } else {
    document.getElementById("certBox").classList.add("hidden");
  }
  
  // Smooth scroll to results
  document.getElementById("resultsArea").scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function downloadCert() { 
  if(window.certLink) window.open(window.certLink); 
  else showToast("Certificate link broken.", "error");
}

/* ------------------------------------------------------------
   3. ADMIN FUNCTIONS
------------------------------------------------------------ */
function attemptLogin() {
  if(document.getElementById("adminUser").value === "admin" && document.getElementById("adminPass").value === "123789") {
    document.getElementById("loginModal").style.display = "none";
    document.getElementById("userView").classList.add("hidden");
    document.getElementById("adminView").classList.remove("hidden");
    showToast("Welcome back, Administrator.", "success");
    refreshAdmin();
  } else {
    showToast("Invalid Credentials", "error");
    document.getElementById("adminPass").value = "";
  }
}

function logout() {
  document.getElementById("adminView").classList.add("hidden");
  document.getElementById("userView").classList.remove("hidden");
  document.getElementById("adminUser").value = "";
  document.getElementById("adminPass").value = "";
  showToast("Logged out successfully.", "info");
}

function refreshAdmin() {
  const vals = Object.values(db);
  const total = vals.length;
  const dq = vals.filter(u => u.ineligible).length;
  const win = vals.filter(u => u.stage === 6).length;

  document.getElementById("statTotal").innerText = total;
  document.getElementById("statDQ").innerText = dq;
  document.getElementById("statWinners").innerText = win;

  // Animate Bars
  setTimeout(() => {
    document.getElementById("barDQ").style.width = (total ? (dq/total)*100 : 0) + "%";
    document.getElementById("barWin").style.width = (total ? (win/total)*100 : 0) + "%";
  }, 200);
  
  const tbody = document.getElementById("admTableBody");
  tbody.innerHTML = "";
  Object.keys(db).forEach(id => {
    const u = db[id];
    let st = u.ineligible ? `<span style="color:var(--google-red); font-weight:bold;">DQ (S${u.stage})</span>` : `Stage ${u.stage}`;
    tbody.innerHTML += `
      <tr>
        <td><b>${id}</b></td>
        <td>${u.name}</td>
        <td>${u.cohort}</td>
        <td>${st}</td>
        <td style="font-size:12px; color:gray;">${u.lastUpdated || '-'}</td>
        <td>
          <div class="admin-actions">
            <button class="edit small" onclick="editUser('${id}')">‚úèÔ∏è</button>
            <button class="danger small" onclick="deleteUser('${id}')">üóëÔ∏è</button>
          </div>
        </td>
      </tr>
    `;
  });
}

function toggleReasonInput() {
  const isChecked = document.getElementById("admIneligible").checked;
  const el = document.getElementById("admReason");
  el.disabled = !isChecked;
  if(!isChecked) el.value = "";
  else el.focus();
}

function saveCandidate() {
  const id = document.getElementById("admId").value.trim();
  const name = document.getElementById("admName").value.trim();
  const isIneligible = document.getElementById("admIneligible").checked;
  const reason = document.getElementById("admReason").value;

  if(!id || !name) return showToast("ID and Name are required.", "error");
  if(isIneligible && !reason) return showToast("Reason required for Disqualification.", "error");

  const old = db[id] || {};
  db[id] = {
    name: name,
    cohort: document.getElementById("admCohort").value,
    stage: parseInt(document.getElementById("admStage").value),
    cert: document.getElementById("admCert").value,
    signed: old.signed || false,
    ineligible: isIneligible,
    reason: reason,
    lastUpdated: new Date().toLocaleDateString()
  };
  saveDB();
  showToast("Candidate Saved!", "success");
  resetForm();
  refreshAdmin();
}

function editUser(id) {
  const u = db[id];
  document.getElementById("admId").value = id;
  document.getElementById("admName").value = u.name;
  document.getElementById("admCohort").value = u.cohort;
  document.getElementById("admStage").value = u.stage;
  document.getElementById("admCert").value = u.cert || "";
  document.getElementById("admIneligible").checked = u.ineligible || false;
  document.getElementById("admReason").value = u.reason || "";
  toggleReasonInput();
  document.getElementById("editFormCard").scrollIntoView({ behavior: "smooth" });
  document.getElementById("formTitle").innerText = "Edit: " + id;
}

function deleteUser(id) {
  if(confirm("Are you sure you want to delete " + id + "?")) { 
    delete db[id]; 
    saveDB(); 
    refreshAdmin();
    showToast("Record deleted.", "info");
  }
}

function resetForm() {
  document.getElementById("admId").value = "";
  document.getElementById("admName").value = "";
  document.getElementById("admCert").value = "";
  document.getElementById("admIneligible").checked = false;
  document.getElementById("admReason").value = "";
  document.getElementById("formTitle").innerText = "Manage Candidate";
  toggleReasonInput();
}

function exportCSV() {
  let csv = "ID,Name,Cohort,Stage,Status,LastUpdated\n";
  for(let id in db) {
    const u = db[id];
    let status = u.ineligible ? "DQ: "+u.reason : (u.stage === 6 ? "Winner" : "In Progress");
    csv += `${id},${u.name},${u.cohort},${u.stage},"${status}",${u.lastUpdated}\n`;
  }
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'GoGen_Candidates.csv';
  a.click();
  showToast("Database exported to CSV.", "success");
}

/* --- EXTRAS --- */
function postAnnouncement() {
  const txt = document.getElementById("admAnnounceInput").value;
  if(!txt) return;
  localStorage.setItem("gogenAnnounce", txt);
  showToast("Announcement Posted!", "success");
}
function clearAnnouncement() {
  localStorage.removeItem("gogenAnnounce");
  document.getElementById("admAnnounceInput").value = "";
  showToast("Announcement Cleared.", "info");
}

function showToast(msg, type='info') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `<span>${msg}</span>`;
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(20px)';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

function triggerConfetti() {
  const colors = ["#4285F4", "#DB4437", "#F4B400", "#0F9D58"];
  for(let i=0; i<60; i++) {
    const p = document.createElement("div");
    p.classList.add("confetti");
    document.body.appendChild(p);
    
    const x = Math.random() * 100;
    const y = -10;
    
    p.style.left = x + "vw";
    p.style.top = y + "px";
    p.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
    
    // Physics
    const duration = Math.random() * 3 + 2;
    p.animate([
      { transform: `translate(0, 0) rotate(0deg)` },
      { transform: `translate(${Math.random()*20-10}vw, 105vh) rotate(${Math.random()*720}deg)` }
    ], {
      duration: duration * 1000,
      easing: 'linear',
      fill: 'forwards'
    });

    setTimeout(() => p.remove(), duration * 1000);
  }
}

function saveDB() { localStorage.setItem("gogenPro_v9", JSON.stringify(db)); }
function toggleTheme() { document.body.classList.toggle("dark"); }
</script>
</body>
</html>
